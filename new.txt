
"""Test script for Outfit2Cart Agent"""
import asyncio
import sys
import os

sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

import config
from agent.outfit2cart_agent import Outfit2CartAgent


async def test_agent():
    """Run the agent with actual Android device"""
    print("\n" + "="*70)
    print(" OUTFIT2CART AGENT - ACTUAL DEVICE TEST")
    print("="*70)
    print("Provider: " + str(config.LLM_PROVIDER))
    print("Model: " + str(config.LLM_MODEL))
    print("Device ID: " + str(config.DEVICE_ID or 'auto-detect'))
    print("WhatsApp Contact: " + str(config.WHATSAPP_TARGET_CONTACT))
    print("Vision Enabled: " + str(config.VISION_ENABLED))
    print("Reasoning Enabled: " + str(config.REASONING_ENABLED))
    print("="*70)
    
    agent = Outfit2CartAgent()
    
    print("\n[1/2] Initializing agent...")
    init_result = await agent.initialize()
    
    if not init_result:
        print("Failed to initialize agent")
        return
    
    print("Agent initialized successfully")
    
    print("\n[2/2] Running workflow...")
    print("-" * 70)
    
    result = await agent.run_workflow()
    
    print("-" * 70)
    
    print("\nWORKFLOW RESULTS:")
    print("   Status: " + str(result.get('status')))
    print("   Message: " + str(result.get('message')))
    if result.get('provider'):
        print("   Provider Used: " + str(result.get('provider')))
    if result.get('contact'):
        print("   WhatsApp Contact: " + str(result.get('contact')))
    
    print("\n" + "="*70)
    if result.get('success'):
        print("WORKFLOW COMPLETED SUCCESSFULLY")
    else:
        error_msg = result.get('error', 'Unknown error')
        print("WORKFLOW FAILED: " + str(error_msg))
    print("="*70 + "\n")
    
    return result


if __name__ == "__main__":
    try:
        result = asyncio.run(test_agent())
        sys.exit(0 if result.get('success') else 1)
    except KeyboardInterrupt:
        print("\n\nTest interrupted by user")
        sys.exit(1)


        old config __file__
        """Configuration for Outfit2Cart agent"""
import os
from dotenv import load_dotenv

load_dotenv()

# LLM Configuration
LLM_PROVIDER = os.getenv("LLM_PROVIDER", "Gemini")  # Gemini, OpenAI, Anthropic
LLM_MODEL = os.getenv("LLM_MODEL", "models/gemini-2.5-pro-preview-05-06")
LLM_API_KEY = os.getenv("GEMINI_API_KEY", "")

# Device Configuration
DEVICE_ID = os.getenv("DEVICE_ID", "")  # Leave empty for auto-detect single device

# App Package Names (configurable for different regions)
PINTEREST_PACKAGE = "com.pinterest"
FLIPKART_PACKAGE = "com.flipkart.android"
WHATSAPP_PACKAGE = "com.whatsapp"



# Agent Configuration
AGENT_TIMEOUT = 120  # seconds
MAX_RETRIES = 2
VISION_ENABLED = True
REASONING_ENABLED = True

# WhatsApp Configuration
WHATSAPP_TARGET_CONTACT = "My Notes"


DROIDRUN_CONFIG = {
    "device_host": "localhost",      # Android device/emulator IP
    "device_port": 5037,             # ADB port
    "enable_logging": True,
    "timeout": 30,
    "retry_attempts": 3
}



old android tool file 

"""Android automation tools for Outfit2Cart"""
import asyncio
from typing import Optional, Dict, Any
import logging

logger = logging.getLogger(__name__)


class AndroidTools:
    """Wrapper for Droidrun Android tools"""
    
    def __init__(self, tools_instance, tool_list):
        """Initialize with Droidrun tools
        
        Args:
            tools_instance: Droidrun tools instance
            tool_list: List of available tools
        """
        self.tools_instance = tools_instance
        self.tool_list = tool_list
    
    async def open_app(self, package_name: str) -> bool:
        """Open an Android app by package name"""
        try:
            logger.info(f"Opening app: {package_name}")
            return True
        except Exception as e:
            logger.error(f"Failed to open app {package_name}: {e}")
            return False
    
    async def take_screenshot(self) -> Optional[str]:
        """Take a screenshot and return path"""
        try:
            logger.info("Taking screenshot...")
            return None
        except Exception as e:
            logger.error(f"Failed to take screenshot: {e}")
            return None
    
    async def wait(self, seconds: float = 1.0) -> None:
        """Wait for specified seconds"""
        await asyncio.sleep(seconds)
    
    async def type_text(self, text: str) -> bool:
        """Type text in the current focused field"""
        try:
            logger.info(f"Typing text: {text[:50]}...")
            return True
        except Exception as e:
            logger.error(f"Failed to type text: {e}")
            return False
    
    async def tap_text(self, text: str) -> bool:
        """Tap on element containing specific text"""
        try:
            logger.info(f"Tapping on text: {text}")
            return True
        except Exception as e:
            logger.error(f"Failed to tap text: {e}")
            return False
    
    async def tap_coordinates(self, x: int, y: int) -> bool:
        ""
        
        
        from droidrun import AndroidDevice
from config import DROIDRUN_CONFIG

class AndroidToolsWithDroidrun:
    def __init__(self):
        self.device = AndroidDevice(
            host=DROIDRUN_CONFIG["device_host"],
            port=DROIDRUN_CONFIG["device_port"]
        )
    
    def connect_to_device(self):
        """Connect to Android device"""
        try:
            self.device.connect()
            print("✅ Connected to Android device")
            return True
        except Exception as e:
            print(f"❌ Connection failed: {e}")
            return False
    
    def get_device_info(self):
        """Get device information"""
        return self.device.get_info()
    
    def install_app(self, app_path):
        """Install APK on device"""
        return self.device.install_app(app_path)
